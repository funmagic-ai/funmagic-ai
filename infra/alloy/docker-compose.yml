services:
  alloy:
    image: grafana/alloy:latest
    container_name: funmagic-alloy
    restart: unless-stopped
    command:
      - run
      - /etc/alloy/config.alloy
    volumes:
      - ./config.alloy:/etc/alloy/config.alloy:ro
      # Mount PM2 log directory (adjust for your deployment)
      - /root/.pm2/logs:/root/.pm2/logs:ro
    network_mode: host # Access localhost metrics endpoints
    environment:
      - ALLOY_ENV=${ALLOY_ENV:-production}
      - GRAFANA_LOKI_URL=${GRAFANA_LOKI_URL}
      - GRAFANA_LOKI_USERNAME=${GRAFANA_LOKI_USERNAME}
      - GRAFANA_LOKI_API_KEY=${GRAFANA_LOKI_API_KEY}
      - GRAFANA_PROMETHEUS_URL=${GRAFANA_PROMETHEUS_URL}
      - GRAFANA_PROMETHEUS_USERNAME=${GRAFANA_PROMETHEUS_USERNAME}
      - GRAFANA_PROMETHEUS_API_KEY=${GRAFANA_PROMETHEUS_API_KEY}
    env_file:
      - ../../.env
